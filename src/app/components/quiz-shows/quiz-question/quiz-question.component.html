<ng-container *ngIf="seasonQuizData$ | async; else dataError">
  <ng-container *ngIf="isQuizInProgress; else quizInit">
    <ng-container *ngTemplateOutlet="quizQuestionFlow"></ng-container>
  </ng-container>
</ng-container>

<ng-template #quizInit>
  <h2 class="heading-secondary py-6">Ready.. Set..</h2>
  <p class="quiz-text-block">
    When the quiz starts you'll have 30 seconds to answer each
    question. Keep an eye on the timer and make sure to submit your answers before time runs out or it will disable the submission button.
  </p>
  <p class="quiz-text-block">Begin whenever you're ready... Good luck!</p>
  <bs-button class="quiz-btn btn-quiz-attempt inline-flex mt-2" (click)="initiateQuiz()">{{ quizBtnState }}</bs-button>
</ng-template>

<ng-template #quizQuestionFlow>
  <ng-container
    *ngIf="{ seasonData: seasonQuizData$ | async, quizTimer: quizTimer$ | async } as vm"
  >
    <ng-container *ngIf="quizBtnState !== 'Complete quiz' && !quizCompleted">
      <!-- <bs-quiz-timer [quizTimer]="vm.quizTimer"></bs-quiz-timer> -->
      <p>{{ questionIndex + 1 }} of {{ numberOfQuestions }}</p>
      <h1>{{ vm?.seasonData?.[questionIndex]?.question }}</h1>
      <bs-button
        *ngFor="let option of vm?.seasonData?.[questionIndex]?.options"
        class="quiz-btn btn-success"
        (click)="setSelectedAnswer(option)"
        [hidden]="vm?.quizTimer?.isTimeUp"
        >{{ option }}</bs-button
      >
    </ng-container>
    <ng-container *ngTemplateOutlet="quizResult"></ng-container>
    <ng-container *ngTemplateOutlet="nextQuestionButton"></ng-container>
  </ng-container>
</ng-template>

<ng-template #nextQuestionButton>
  <bs-button
    class="quiz-btn btn-success"
    (click)="quizBtnState === 'Next' ? toggleNextQuestion() : toggleQuizComplete()"
  >
    {{ quizBtnState }}
  </bs-button>
</ng-template>

<ng-template #quizResult>
  <ng-container *ngIf="quizCompleted">
    <p>Your score: {{ userQuizResult }}</p>
    <ng-container *ngIf="authError$ | async as authError; else userMessage">
      <span>{{ authError }}</span>
    </ng-container>
    <ng-template #userMessage>
      <p>View your results on <a [routerLink]="['/' + Paths.PROFILE]">your profile page</a></p>
    </ng-template>
  </ng-container>
</ng-template>

<ng-template #dataError>
  <bs-data-error></bs-data-error>
</ng-template>

<bs-achievement-notification></bs-achievement-notification>
